name: Haskell CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Haskell
      uses: haskell/actions/setup@v2
      with:
        ghc-version: '9.4'
        cabal-version: '3.8'
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libgmp-dev
        
    - name: Check Fourmolu formatting
      run: |
        cabal update
        cabal install fourmolu
        ~/.cabal/bin/fourmolu --mode check src/Euler4.hs src/Euler27.hs src/test_euler.hs
        
    - name: Run HLint
      run: |
        cabal install hlint
        ~/.cabal/bin/hlint src/Euler4.hs src/Euler27.hs src/test_euler.hs
        
    - name: Run Haskell tests
      run: |
        echo "=== Running Haskell tests ==="
        stack test
        
    - name: Run Python tests  
      run: |
        echo "=== Running Python tests ==="
        python3 src/test_euler.py